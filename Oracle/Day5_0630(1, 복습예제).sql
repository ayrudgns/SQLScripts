-- 작성자 : JULEEUS
-- 1번
CREATE TABLE TBL_CUSTOM (
	CUSTOM_ID VARCHAR2(20) PRIMARY KEY,		
	NAME NVARCHAR2(20) NOT NULL,
	EMAIL VARCHAR2(20),
	AGE NUMBER(3),
	REG_DATE DATE DEFAULT SYSDATE
);

-- 상품 테이블 : 카테고리 A1 : 전자제품, B1 : 식품
CREATE TABLE TBL_PRODUCT (
	PCODE VARCHAR2(20) PRIMARY KEY,
	CATEGORY CHAR(2) NOT NULL,
	PNAME NVARCHAR2(20) NOT NULL,
	PRICE NUMBER(9) NOT NULL
);

-- 구매 테이블 : 어느 고객이 무슨 상품을 구입하는가?
CREATE TABLE TBL_BUY(
	CUSTOM_ID VARCHAR2(20) NOT NULL,
	PCODE VARCHAR2(20) NOT NULL,
	QUANTITY NUMBER(5) NOT NULL,
	BUY_DATE DATE DEFAULT SYSDATE
);

-- DATA 형식에 지정되는 패턴 설정하기
-- INSERT할 때 TO_DATE 함수 생략이 가능해진다. 즉, 날짜 형식을 고정시켜준다.
ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD HH24:MI:SS';

-- 확인
SELECT * FROM TBL_CUSTOM;
SELECT * FROM TBL_PRODUCT;
SELECT * FROM TBL_BUY;

-- 2번
--TO_DATE('2022-03-04 16:47', 'YYYY-MM-DD HH24:MI')
INSERT INTO TBL_CUSTOM VALUES
	('mina012', '김미나', 'kimm@gmail.com', 20, TO_DATE('2022-03-10 14:23:25', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TBL_CUSTOM VALUES
	('hongGD', '홍길동', 'gil@korea.com', 32, TO_DATE('2021-10-21', 'YYYY-MM-DD'));
INSERT INTO TBL_CUSTOM VALUES
	('twice', '박모모', 'momo@daum.net', 29, TO_DATE('2021-10-25', 'YYYY-MM-DD'));
--INSERT INTO TBL_CUSTOM VALUES 
--	('wonder', '이나나', 'lee@naver.com', 40, SYSDATE);
-- SYSDATE를 사용하지 않고 쓰기, DEFAULT를 선언한 이유!
INSERT INTO TBL_CUSTOM (CUSTOM_ID, NAME, EMAIL, AGE) VALUES 
	('wonder', '이나나', 'lee@naver.com', 40);
INSERT INTO TBL_CUSTOM VALUES
	('twice1', '박모모2', 'momo@daum.net', 29, '2021-10-25 19:23:45');

INSERT INTO TBL_PRODUCT VALUES
	('IPAD011', 'A1', '아이패드10', 880000);
INSERT INTO TBL_PRODUCT VALUES
	('DOWON123a', 'B1', '동원참치선물세트', 54000);
INSERT INTO TBL_PRODUCT VALUES
	('dk_143', 'A2', '모션데스크', 234500);

INSERT INTO TBL_BUY VALUES
	('mina012', 'IPAD011', 1, TO_DATE('2022-02-06', 'YYYY-MM-DD'));
INSERT INTO TBL_BUY VALUES
	('hongGD', 'IPAD011', 2, TO_DATE('2022-06-29 20:37:47', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TBL_BUY VALUES
	('wonder', 'DOWON123a', 3, TO_DATE('2022-02-06', 'YYYY-MM-DD'));
INSERT INTO TBL_BUY VALUES
	('mina012', 'dk_143', 1, SYSDATE);
INSERT INTO TBL_BUY VALUES 
	('twice', 'DOWON123a', 2, TO_DATE('2022-02-09 08:49:55', 'YYYY-MM-DD HH24:MI:SS'));

-- 확인
SELECT * FROM TBL_CUSTOM;
SELECT * FROM TBL_PRODUCT;
SELECT * FROM TBL_BUY;

-- 3번
ALTER TABLE TBL_BUY ADD BUYNO NUMBER(8);

-- 4번
UPDATE TBL_BUY SET BUYNO = 1001 WHERE CUSTOM_ID = 'mina012' AND PCODE = 'IPAD011';
UPDATE TBL_BUY SET BUYNO = 1002 WHERE CUSTOM_ID = 'hongGD' AND PCODE = 'IPAD011';
UPDATE TBL_BUY SET BUYNO = 1003 WHERE CUSTOM_ID = 'wonder' AND PCODE = 'DOWON123a';
UPDATE TBL_BUY SET BUYNO = 1004 WHERE CUSTOM_ID = 'mina012' AND PCODE = 'dk_143';
UPDATE TBL_BUY SET BUYNO = 1005 WHERE CUSTOM_ID = 'twice' AND PCODE = 'DOWON123a';

-- 5번
ALTER TABLE TBL_BUY ADD CONSTRAINTS TBL_BUY__PK_BUYNO PRIMARY KEY (BUYNO);

-- 6번
ALTER TABLE TBL_BUY ADD CONSTRAINTS TBL_BUY__FK1_CUSTOM_ID
	FOREIGN KEY (CUSTOM_ID) REFERENCES TBL_CUSTOM(CUSTOM_ID);
ALTER TABLE TBL_BUY ADD CONSTRAINTS TBL_BUY__FK2_PCODE
	FOREIGN KEY (PCODE) REFERENCES TBL_PRODUCT(PCODE);
	
-- 7번
CREATE SEQUENCE TBLBUY_SEQ START WITH 1006;

-- 8번
INSERT INTO TBL_BUY VALUES
	('wonder', 'IPAD011', 1, TO_DATE('2022-05-15', 'YYYY-MM-DD'), TBLBUY_SEQ.NEXTVAL);

-- 확인
SELECT * FROM TBL_CUSTOM;
SELECT * FROM TBL_PRODUCT;
SELECT * FROM TBL_BUY;

-- 9번
SELECT * FROM TBL_CUSTOM WHERE AGE >= 30;
SELECT EMAIL FROM TBL_CUSTOM WHERE CUSTOM_ID = 'twice';
SELECT PNAME FROM TBL_PRODUCT WHERE CATEGORY = 'A2';
SELECT MAX(PRICE) FROM TBL_PRODUCT;		-- 최고값 조회
SELECT SUM(QUANTITY) FROM TBL_BUY WHERE PCODE = 'IPAD011';
SELECT * FROM TBL_BUY WHERE CUSTOM_ID = 'mina012';
SELECT * FROM TBL_BUY WHERE PCODE LIKE '%0%';
SELECT * FROM TBL_BUY WHERE UPPER(PCODE) LIKE '%ON%';